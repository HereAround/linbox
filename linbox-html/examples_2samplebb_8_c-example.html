<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>linbox: examples/samplebb.C</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">linbox
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search');
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">examples/samplebb.C</div>  </div>
</div><!--header-->
<div class="contents">
<p>generate an example matrix with specified frobenius form.samplebb takes options and any number of argument triples denoting companion matrix blocks. For example, the call "samplebb -r 7 2 3 a3 1 1" generates a sparsely randomized matrix (because of the '-r' option) matrix which is similar (because of the two triples '7 2 3' and 'a2 1 1') to a direct sum of 3 companion matrices for (x-7)^2 plus one companion matrix for x^3 + x + 2, the polynomial denoted by 'a3'.</p>
<p>In general, in the first position of each triple 'aK' denotes the polynomial x^k + x + K-1 and a number n denotes the polynomial x-n. The second number in the triple specifies a power of the polynomial and the third specifies how many companion matrix blocks for that power of that polynomial.</p>
<p>Possible options are -r lightly randomized similarity transform, matrix remains sparse. -R fully randomized similarity transform, matrix becomes dense.</p>
<p>The matrix is written to standard out in SMS format (triples).</p>
<p>For some other examples: "samplebb  1 1 2  2 1 2  4 1 2  12 1 1  0 1 1" is a 8 by 8 diagonal matrix in smith form, diag(1,1,2,2,4,4,12,0)</p>
<div class="fragment"><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment"> * examples/samplebb.C</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * Copyright (C) 2005, 2010 D Saunders</span></div><div class="line"><span class="comment"> * ========LICENCE========</span></div><div class="line"><span class="comment"> * This file is part of the library LinBox.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * LinBox is free software: you can redistribute it and/or modify</span></div><div class="line"><span class="comment"> * it under the terms of the  GNU Lesser General Public</span></div><div class="line"><span class="comment"> * License as published by the Free Software Foundation; either</span></div><div class="line"><span class="comment"> * version 2.1 of the License, or (at your option) any later version.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * This library is distributed in the hope that it will be useful,</span></div><div class="line"><span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div><div class="line"><span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span></div><div class="line"><span class="comment"> * Lesser General Public License for more details.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * You should have received a copy of the GNU Lesser General Public</span></div><div class="line"><span class="comment"> * License along with this library; if not, write to the Free Software</span></div><div class="line"><span class="comment"> * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA</span></div><div class="line"><span class="comment"> * ========LICENCE========</span></div><div class="line"><span class="comment"> */</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;string&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;list&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;vector&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;linbox/blackbox/direct-sum.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;linbox/blackbox/companion.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="matrix-hom_8h.html">linbox/algorithms/matrix-hom.h</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;linbox/ring/ntl.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;NTL/ZZX.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="blas-vector_8h.html">linbox/vector/blas-vector.h</a>&gt;</span></div><div class="line"></div><div class="line"><span class="keyword">using</span> std::string;</div><div class="line"><span class="keyword">using</span> std::list;</div><div class="line"><span class="keyword">using</span> <a name="_a0"></a><a class="code" href="struct_lin_box_1_1_companion.html">LinBox::Companion</a>;</div><div class="line"><span class="keyword">using</span> <a name="_a1"></a><a class="code" href="class_lin_box_1_1_direct_sum.html">LinBox::DirectSum</a>;</div><div class="line"><span class="keyword">using</span> <a name="_a2"></a><a class="code" href="class_lin_box_1_1_blas_matrix.html">LinBox::DenseMatrix</a>;</div><div class="line"><span class="keyword">using</span> <a name="_a3"></a><a class="code" href="class_lin_box_1_1_n_t_l___z_z.html">LinBox::NTL_ZZ</a>;</div><div class="line"><span class="keyword">using</span> NTL::ZZX;</div><div class="line"></div><div class="line"></div><div class="line"><span class="keywordtype">void</span> stripOptions(<span class="keywordtype">int</span>&amp; acp, <span class="keywordtype">char</span>* avp[], <span class="keywordtype">string</span>&amp; opts, <span class="keyword">const</span> <span class="keywordtype">int</span> ac, <span class="keywordtype">char</span>** av)</div><div class="line">{</div><div class="line">    acp = 0;</div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 1; i &lt; ac; ++i)</div><div class="line">    {</div><div class="line">        <span class="comment">//std::cout &lt;&lt; av[i] &lt;&lt; &quot; &quot;;</span></div><div class="line">        <span class="keywordflow">if</span> (av[i][0] == <span class="charliteral">&#39;-&#39;</span>) {</div><div class="line">            <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keywordtype">char</span>* j = av[i]+1; *j != 0; ++j)</div><div class="line">                opts.push_back(*j);</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="keywordflow">else</span> {</div><div class="line">            avp[acp] = av[i];</div><div class="line">            ++acp;</div><div class="line">        }</div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> List, <span class="keyword">class</span> Ring&gt;</div><div class="line"><span class="keywordtype">void</span> augmentBB(List&amp; L, <span class="keywordtype">char</span>* code, <span class="keywordtype">int</span> e, <span class="keywordtype">int</span> k, <span class="keyword">const</span> Ring&amp; R)</div><div class="line">{</div><div class="line">    <span class="keyword">typedef</span> <span class="keyword">typename</span> Ring::Element Int;</div><div class="line">    Int a;</div><div class="line">    ZZX p;</div><div class="line"></div><div class="line">    <span class="comment">// build poly p</span></div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> ( *code != <span class="charliteral">&#39;a&#39;</span>)  <span class="comment">// build linear poly</span></div><div class="line">    {</div><div class="line">        R.init(a, -atoi(code));</div><div class="line">        p += ZZX(0, a);</div><div class="line">        p += ZZX(1, R.one);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span> <span class="comment">// build long poly</span></div><div class="line">    {</div><div class="line">        <span class="keywordtype">int</span> n = atoi(code+1);</div><div class="line">        R.init(a, n-1);</div><div class="line">        p += ZZX(n, R.one);</div><div class="line">        p += ZZX(1, R.one);</div><div class="line">        p += ZZX(0, a);</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">//std::cout &lt;&lt; &quot;(code, e, k) =(&quot; &lt;&lt; code &lt;&lt; &quot;, &quot; &lt;&lt; e &lt;&lt; &quot;, &quot; &lt;&lt; k &lt;&lt; &quot;)&quot; &lt;&lt; std::endl;</span></div><div class="line">    <span class="comment">//std::cout &lt;&lt; &quot;Correspoding poly: &quot; &lt;&lt; p &lt;&lt; std::endl;</span></div><div class="line">    <span class="comment">// compute q =  p^e</span></div><div class="line">    ZZX q(0, R.one);</div><div class="line">    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; e; ++i) q *= p;</div><div class="line">    <span class="comment">//std::cout &lt;&lt;&quot;Polynomial: &quot; &lt;&lt; q &lt;&lt; std::endl;</span></div><div class="line"></div><div class="line">    LinBox::DenseVector&lt;Ring&gt;  v(R,deg(q)+1);</div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; v.size(); ++i) v[i] = coeff(q, i);</div><div class="line"></div><div class="line">    <span class="comment">// companion matrix of q</span></div><div class="line">    Companion&lt;Ring&gt;* C = <span class="keyword">new</span> Companion&lt;Ring&gt;(R, v);</div><div class="line">    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; k; ++i) L.push_back(C);</div><div class="line"></div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">template</span> &lt; <span class="keyword">class</span> Ring &gt;</div><div class="line"><span class="keywordtype">void</span> scramble(DenseMatrix&lt;Ring&gt;&amp; M)</div><div class="line">{</div><div class="line"></div><div class="line">    Ring R = M.field();</div><div class="line"></div><div class="line">    <span class="keywordtype">int</span> N,n = M.rowdim(); <span class="comment">// number of random basic row and col ops.</span></div><div class="line">    N = 2*n;</div><div class="line"></div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; N; ++k) {</div><div class="line"></div><div class="line">        <span class="keywordtype">int</span> i = rand()%M.rowdim();</div><div class="line"></div><div class="line">        <span class="keywordtype">int</span> j = rand()%M.coldim();</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span> (i == j) <span class="keywordflow">continue</span>;</div><div class="line"></div><div class="line">        <span class="comment">// M*i += alpha M*j and Mj* -= alpha Mi*</span></div><div class="line"></div><div class="line">        <span class="keyword">typename</span> Ring::Element alpha, beta, x;</div><div class="line">        R.init(alpha, rand()%5 - 2);</div><div class="line">        R.neg(beta, alpha);</div><div class="line"></div><div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> l = 0; l &lt; M.rowdim(); ++l) <span class="keywordflow">if</span> (!R.isZero(alpha)) {</div><div class="line">            R.mul(x, alpha, M[l][j]);</div><div class="line">            R.addin(M[l][i], x);</div><div class="line">        }</div><div class="line"></div><div class="line"></div><div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> l = 0; l &lt; M.rowdim(); ++l) <span class="keywordflow">if</span> (!R.isZero(alpha)) {</div><div class="line">            R.mul(x, beta, M[i][l]);</div><div class="line">            R.addin(M[j][l], x);</div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">/*</span></div><div class="line"><span class="comment">       std::ofstream out(&quot;matrix&quot;, std::ios::out);</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">    //M. write(std::cout);</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">    out &lt;&lt; n &lt;&lt; &quot; &quot; &lt;&lt; n &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">    for (int i = 0; i &lt; n; ++ i) {</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">    for ( int j = 0; j &lt; n; ++ j) {</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">    R. write(out, M[i][j]);</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">    out &lt;&lt; &quot; &quot;;</span></div><div class="line"><span class="comment">    }</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">    out &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">    }</span></div><div class="line"><span class="comment">    */</span></div><div class="line"></div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> Matrix&gt;</div><div class="line"><span class="keywordtype">void</span> printMatrix (<span class="keyword">const</span> <a name="_a4"></a><a class="code" href="class_lin_box_1_1_blas_matrix.html">Matrix</a>&amp; A)</div><div class="line">{</div><div class="line">    <span class="keywordtype">int</span> m = A. rowdim();</div><div class="line">    <span class="keywordtype">int</span> n = A. coldim();</div><div class="line">    <span class="keyword">typedef</span> <span class="keyword">typename</span> Matrix::Field Ring;</div><div class="line">    <span class="keyword">typedef</span> <span class="keyword">typename</span> Ring::Element Element;</div><div class="line">    <span class="keyword">const</span> Ring &amp;r = A.<a name="a5"></a>field();</div><div class="line">    LinBox::DenseVector&lt;Ring&gt; x(r,m), y(r,n);</div><div class="line"></div><div class="line">    std::cout &lt;&lt; m &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; n &lt;&lt;  <span class="stringliteral">&quot; M&quot;</span> &lt;&lt; std::endl;</div><div class="line">    <span class="keyword">typename</span> LinBox::DenseVector&lt;Ring&gt;::iterator y_p;</div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; m; ++ i) {</div><div class="line">        r. assign (x[i], r.one);</div><div class="line">        A. applyTranspose(y, x);</div><div class="line">        <span class="keywordflow">for</span>(y_p = y. begin(); y_p != y. end(); ++ y_p)</div><div class="line">            <span class="keywordflow">if</span> (! r.isZero(*y_p))</div><div class="line">                std::cout &lt;&lt; i+1 &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; y_p - y.begin() + 1 &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; *y_p &lt;&lt; std::endl;</div><div class="line">        r. assign (x[i], r.zero);</div><div class="line">    }</div><div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;0 0 0&quot;</span> &lt;&lt; std::endl;</div><div class="line">}</div><div class="line"></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> ac, <span class="keywordtype">char</span>* av[])</div><div class="line">{</div><div class="line">    <span class="keywordflow">if</span> (ac &lt; 2)</div><div class="line">    {   std::cout &lt;&lt; <span class="stringliteral">&quot;usage: &quot;</span> &lt;&lt; av[0] &lt;&lt;</div><div class="line">        <span class="stringliteral">&quot; options block-groups.&quot;</span> &lt;&lt; std::endl;</div><div class="line">        std::cout &lt;&lt; av[0] &lt;&lt; <span class="stringliteral">&quot; -r 1 2 3 a4 1 1&quot;</span> &lt;&lt; std::endl;</div><div class="line">        std::cout &lt;&lt;</div><div class="line">        <span class="stringliteral">&quot;for lightly randomized matrix similar to direct sum of 3 copies of companion &quot;</span> &lt;&lt; std::endl</div><div class="line">        &lt;&lt; <span class="stringliteral">&quot;matrix of (x-1)^2 and one copy of companion matrix of (x^4 + x + 3)^1.&quot;</span> &lt;&lt; std::endl;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">typedef</span> NTL_ZZ Ring;</div><div class="line">    Ring Z;</div><div class="line">    <span class="keyword">typedef</span> Companion&lt;Ring&gt; BB;</div><div class="line">    <span class="keywordtype">int</span> acp; <span class="keywordtype">char</span>* avp[ac];</div><div class="line">    <span class="keywordtype">string</span> opts;</div><div class="line">    stripOptions(acp, avp, opts, ac, av);</div><div class="line">    <span class="comment">//std::cout &lt;&lt; &quot;number of triples: &quot; &lt;&lt; acp &lt;&lt; std::endl;</span></div><div class="line">    <span class="comment">//for (int i = 0; i &lt; acp; ++ i)</span></div><div class="line">    <span class="comment">//  std::cout &lt;&lt; avp[i];</span></div><div class="line">    <span class="comment">//std::cout &lt;&lt; std::endl;</span></div><div class="line">    <span class="comment">//std::cout &lt;&lt; &quot;Begin to ....\n&quot;;</span></div><div class="line">    list&lt;BB*&gt; L;</div><div class="line"></div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; acp; i += 3)</div><div class="line">        augmentBB(L, avp[i], atoi(avp[i+1]), atoi(avp[i+2]), Z);</div><div class="line"></div><div class="line">    DirectSum&lt;BB&gt; A(L);</div><div class="line">    <span class="comment">//std::cout &lt;&lt;&quot;Option: &quot; &lt;&lt; opts.c_str() &lt;&lt; std::endl;</span></div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (opts.size() &gt;= 1)</div><div class="line">    {   <span class="keywordflow">if</span> (opts[0] == <span class="charliteral">&#39;r&#39;</span>)</div><div class="line">        {</div><div class="line">            <span class="comment">// into sparse matrix, then 3n row ops with corresponding col ops</span></div><div class="line">            DenseMatrix&lt;Ring&gt; B(Z,A.rowdim(), A.coldim());</div><div class="line">            <span class="comment">//MatrixDomain&lt;Ring&gt; MD(Z);</span></div><div class="line">            LinBox::MatrixHom::map (B, A);</div><div class="line"></div><div class="line">            scramble(B);</div><div class="line">            printMatrix(B);</div><div class="line">            <span class="comment">// delete B;</span></div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span> (opts[0] == <span class="charliteral">&#39;R&#39;</span>) { <span class="keywordflow">throw</span> LinBox::NotImplementedYet(); }</div><div class="line">        <span class="comment">// into dense matrix, then many row ops</span></div><div class="line">        <span class="comment">//...</span></div><div class="line"></div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span> {</div><div class="line">        printMatrix (A);</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> 0 ;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">// Local Variables:</span></div><div class="line"><span class="comment">// mode: C++</span></div><div class="line"><span class="comment">// tab-width: 4</span></div><div class="line"><span class="comment">// indent-tabs-mode: nil</span></div><div class="line"><span class="comment">// c-basic-offset: 4</span></div><div class="line"><span class="comment">// End:</span></div><div class="line"><span class="comment">// vim:sts=4:sw=4:ts=4:et:sr:cino=&gt;s,f0,{0,g0,(0,\:0,t0,+0,=s</span></div></div><!-- fragment --> </div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Jun 5 2019 14:05:42 for linbox by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
